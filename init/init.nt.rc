#
# Copyright (C) 2022 The Nameless-AOSP Project
#
# SPDX-License-Identifier: Apache-2.0
#

on early-boot
    # SSR
    write /sys/bus/msm_subsys/devices/subsys0/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys1/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys2/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys3/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys4/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys5/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys6/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys7/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys8/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys9/restart_level RELATED
    write /sys/bus/msm_subsys/devices/subsys10/restart_level RELATED

on boot
    # Charging
    write /sys/class/qcom-battery/slowcharge_en 0

    # Display
    chown system system /sys/class/drm/sde-conn-1-DSI-1/panel_id

    # Fingerprint
    chown system system /dev/goodix_fp

    # Gestures
    chown system system /sys/class/spi_master/spi0/spi0.0/fts_gestures
    chown system system /sys/class/spi_master/spi0/spi0.0/fts_gesture_double_tap_pressed
    chown system system /sys/class/spi_master/spi0/spi0.0/fts_gesture_fod_pressed
    chown system system /sys/class/spi_master/spi0/spi0.0/fts_gesture_single_tap_pressed

    # Glyph
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/all_leds_effect
    chmod 0666 /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/all_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/all_white_leds_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/glo_current
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/rear_cam_led_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/front_cam_led_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/horse_race_leds_br
    chmod 0666 /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/horse_race_leds_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/round_leds_br
    chmod 0666 /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/round_leds_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/single_led_br
    chmod 0666 /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/single_led_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/round_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/horse_race_leds
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/wired_charging_leds
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/random_delay
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/random_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/keybd_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/wlr_charging_leds
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/video_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/ga_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/nf_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/bootan_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/rear_cam_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/music_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/ringtone_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/flip_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/exclamation_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/setting_leds_effect
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/setting_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/vline_leds_br
    chown system system /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/dot_led_br

on property:sys.boot_completed=1
    # Camera
    copy /mnt/vendor/persist/camera/bokeh_caldata_uw_persist.bin /data/vendor/camera/bokeh_caldata_uw_persist.bin
    copy /mnt/vendor/persist/camera/ois_caldata_wide_persist.bin /data/vendor/camera/ois_caldata_wide_persist.bin
    chown cameraserver audio /data/vendor/camera/bokeh_caldata_uw_persist.bin
    chown cameraserver audio /data/vendor/camera/ois_caldata_wide_persist.bin

    # Disable zram readahead
    write /proc/sys/vm/page-cluster 0
    # Override readahead to 2MiB during boot
    write /sys/block/dm-0/queue/read_ahead_kb 2048
    write /sys/block/dm-1/queue/read_ahead_kb 2048
    write /sys/block/dm-2/queue/read_ahead_kb 2048
    write /sys/block/dm-3/queue/read_ahead_kb 2048
    write /sys/block/dm-4/queue/read_ahead_kb 2048
    write /sys/block/dm-5/queue/read_ahead_kb 2048
    write /sys/block/dm-6/queue/read_ahead_kb 2048
    write /sys/block/dm-7/queue/read_ahead_kb 2048
    write /sys/block/dm-8/queue/read_ahead_kb 2048
    write /sys/block/dm-9/queue/read_ahead_kb 2048
    write /sys/block/mmcblk0/queue/read_ahead_kb 2048
    write /sys/block/sda/queue/read_ahead_kb 2048
    write /sys/block/sdb/queue/read_ahead_kb 2048
    write /sys/block/sdc/queue/read_ahead_kb 2048
    write /sys/block/sdd/queue/read_ahead_kb 2048
    write /sys/block/sde/queue/read_ahead_kb 2048
    write /sys/block/sdf/queue/read_ahead_kb 2048

on property:vendor.post_boot.parsed=1
    # Set cpuset audio-app
    write /dev/cpuset/audio-app/cpus 1-2
    # Set restricted cpuset to the same CPUs as system-background
    copy /dev/cpuset/system-background/cpus /dev/cpuset/restricted/cpus
    # Reset readahead to 128KiB
    write /sys/block/dm-0/queue/read_ahead_kb 128
    write /sys/block/dm-1/queue/read_ahead_kb 128
    write /sys/block/dm-2/queue/read_ahead_kb 128
    write /sys/block/dm-3/queue/read_ahead_kb 128
    write /sys/block/dm-4/queue/read_ahead_kb 128
    write /sys/block/dm-5/queue/read_ahead_kb 128
    write /sys/block/dm-6/queue/read_ahead_kb 128
    write /sys/block/dm-7/queue/read_ahead_kb 128
    write /sys/block/dm-8/queue/read_ahead_kb 128
    write /sys/block/dm-9/queue/read_ahead_kb 128
    write /sys/block/dm-10/queue/read_ahead_kb 128
    write /sys/block/dm-11/queue/read_ahead_kb 128
    write /sys/block/dm-12/queue/read_ahead_kb 128
    write /sys/block/dm-13/queue/read_ahead_kb 128
    write /sys/block/dm-14/queue/read_ahead_kb 128
    write /sys/block/dm-15/queue/read_ahead_kb 128
    write /sys/block/dm-16/queue/read_ahead_kb 128
    write /sys/block/dm-17/queue/read_ahead_kb 128
    write /sys/block/dm-18/queue/read_ahead_kb 128
    write /sys/block/dm-19/queue/read_ahead_kb 128
    write /sys/block/dm-20/queue/read_ahead_kb 128
    write /sys/block/dm-21/queue/read_ahead_kb 128
    write /sys/block/dm-22/queue/read_ahead_kb 128
    write /sys/block/dm-23/queue/read_ahead_kb 128
    write /sys/block/dm-24/queue/read_ahead_kb 128
    write /sys/block/dm-25/queue/read_ahead_kb 128
    write /sys/block/dm-26/queue/read_ahead_kb 128
    write /sys/block/dm-27/queue/read_ahead_kb 128
    write /sys/block/dm-28/queue/read_ahead_kb 128
    write /sys/block/dm-29/queue/read_ahead_kb 128
    write /sys/block/dm-30/queue/read_ahead_kb 128
    write /sys/block/dm-31/queue/read_ahead_kb 128
    write /sys/block/dm-32/queue/read_ahead_kb 128
    write /sys/block/dm-33/queue/read_ahead_kb 128
    write /sys/block/dm-34/queue/read_ahead_kb 128
    write /sys/block/dm-35/queue/read_ahead_kb 128
    write /sys/block/dm-36/queue/read_ahead_kb 128
    write /sys/block/dm-37/queue/read_ahead_kb 128
    write /sys/block/dm-38/queue/read_ahead_kb 128
    write /sys/block/dm-39/queue/read_ahead_kb 128
    write /sys/block/dm-40/queue/read_ahead_kb 128
    write /sys/block/dm-41/queue/read_ahead_kb 128
    write /sys/block/dm-42/queue/read_ahead_kb 128
    write /sys/block/dm-43/queue/read_ahead_kb 128
    write /sys/block/dm-44/queue/read_ahead_kb 128
    write /sys/block/dm-45/queue/read_ahead_kb 128
    write /sys/block/dm-46/queue/read_ahead_kb 128
    write /sys/block/dm-47/queue/read_ahead_kb 128
    write /sys/block/dm-48/queue/read_ahead_kb 128
    write /sys/block/dm-49/queue/read_ahead_kb 128
    write /sys/block/mmcblk0/queue/read_ahead_kb 128
    write /sys/block/sda/queue/read_ahead_kb 128
    write /sys/block/sdb/queue/read_ahead_kb 128
    write /sys/block/sdc/queue/read_ahead_kb 128
    write /sys/block/sdd/queue/read_ahead_kb 128
    write /sys/block/sde/queue/read_ahead_kb 128
    write /sys/block/sdf/queue/read_ahead_kb 128

on property:ro.board.platform=lahaina
    # Setup foreground cpuset for display composer.
    write /dev/cpuset/foreground/cpus 0-6
    
    # Boot led effect placeholder
on property:service.bootanim.exit=0
   write /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/bootan_leds_effect 1

on property:service.bootanim.exit=1
   write /sys/devices/platform/soc/984000.i2c/i2c-0/0-0020/leds/aw210xx_led/bootan_leds_effect 0

    # Health
    restart health-hal-2-1
